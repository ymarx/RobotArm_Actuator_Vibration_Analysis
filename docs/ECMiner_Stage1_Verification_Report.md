# ECMiner Stage1 ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-11-24
**ìŠ¤í¬ë¦½íŠ¸**: `ecminer_stage1_complete.py`
**ëª©ì **: ECMinerìš© ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ê²€ì¦

---

## âœ… ê²€ì¦ ê²°ê³¼ ìš”ì•½

### 1. Input/Output í™•ì¸ âœ…

| í•­ëª© | ìƒíƒœ | ì„¸ë¶€ì‚¬í•­ |
|------|------|---------|
| **ì…ë ¥** | âœ… | Raw CSV íŒŒì¼ (data/100W/, data/200W/) |
| **ì¶œë ¥** | âœ… | CSV íŒŒì¼ (ecminer_stage1_output.csv) |
| **ì¤‘ê°„ ì‚°ì¶œë¬¼** | âœ… | **Parquet ë¯¸ì‚¬ìš©** (Raw â†’ CSV ì§ì ‘ ë³€í™˜) |

**ì…ë ¥ ì†ŒìŠ¤**:
- `data/100W/*.csv`: 30ê°œ íŒŒì¼
- `data/200W/*.csv`: 30ê°œ íŒŒì¼
- ì´ 60ê°œ íŒŒì¼ (57ê°œ usable)

**ì¶œë ¥ ë°ì´í„°**:
- 647 rows Ã— 25 columns
- 18 features + 7 metadata columns

### 2. ì „ì²˜ë¦¬ ê¸°ëŠ¥ í¬í•¨ ì—¬ë¶€ âœ…

| ê¸°ëŠ¥ | í¬í•¨ ì—¬ë¶€ | êµ¬í˜„ ë°©ì‹ |
|------|----------|----------|
| **Raw CSV ë¡œë“œ** | âœ… | `load_all_csv_files()` |
| **ë ˆì´ë¸” ë§¤ì¹­** | âœ… | `load_labels_from_excel()` + `create_file_master_table()` |
| **í’ˆì§ˆ ê²€ì‚¬** | âœ… | `clean_timeseries()` + `create_quality_report()` |
| **Train/Val/Test ë¶„í• ** | âœ… | `assign_split_sets()` (ì‹œê°„ ê¸°ë°˜ + íŒŒì¼ ê¸°ë°˜) |
| **ìœˆë„ìš° ìŠ¬ë¼ì´ë”©** | âœ… | `create_windows_metadata()` (8ì´ˆ, 50% ì˜¤ë²„ë©) |
| **ê¸°ë³¸ íŠ¹ì„± ì¶”ì¶œ (9ê°œ)** | âœ… | `extract_basic_features()` (RMS, Peak, Crest) |
| **Band RMS ì¶”ì¶œ (9ê°œ)** | âœ… | `extract_band_rms_features()` + Butterworth filter |

**ëª¨ë“  Phase3-1 ì „ì²˜ë¦¬ ë‹¨ê³„ í¬í•¨ ì™„ë£Œ** âœ…

### 3. ì¤‘ê°„ ì‚°ì¶œë¬¼ í™•ì¸ âœ…

```python
# ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦ ê²°ê³¼
Parquet ì €ì¥ (to_parquet):   0íšŒ ë°œìƒ âœ…
Parquet ë¡œë“œ (read_parquet): 0íšŒ ë°œìƒ âœ…
```

**ê²°ë¡ **: **Raw CSV â†’ ë©”ëª¨ë¦¬ ì²˜ë¦¬ â†’ CSV ì¶œë ¥** (ì¤‘ê°„ íŒŒì¼ ì—†ìŒ)

### 4. ë°ì´í„° ë¬´ê²°ì„± í™•ì¸ âœ…

| ê²€ì¦ í•­ëª© | ê²°ê³¼ | ì„¤ëª… |
|----------|------|------|
| **Oversampling** | âœ… ì—†ìŒ | `sample(replace=True)` ì½”ë“œ ì—†ìŒ |
| **ë°ì´í„° ì¦ê°•** | âœ… ì—†ìŒ | SMOTE, augmentation ì—†ìŒ |
| **Balance í•¨ìˆ˜** | âœ… í˜¸ì¶œ ì•ˆí•¨ | `balance_train_windows()` ë¯¸ì‚¬ìš© |
| **ì¤‘ë³µ ìƒì„±** | âœ… ì—†ìŒ | `replace=True` ì—†ìŒ |

**ë°ì´í„° ëˆ„ìˆ˜ ë° ì¸ìœ„ì  ì¦ê°• ì—†ìŒ** âœ…

### 5. ì¶œë ¥ ë°ì´í„° ê²€ì¦ âœ…

```
Shape: 647 rows Ã— 25 columns

Features (18):
  - ê¸°ë³¸ 9ê°œ: acc_Y_rms, acc_Y_peak, acc_Y_crest, ...
  - Band RMS 9ê°œ: acc_Y_rms_low, acc_Y_rms_mid, acc_Y_rms_high, ...

Metadata (7):
  - window_id, file_id, dataset_type, label_binary
  - product, sample, direction

Dataset ë¶„í¬:
  train: 444 windows (Normal: 123, Abnormal: 321)
  val:    92 windows (Normal:   4, Abnormal:  88)
  test:  111 windows (Normal:  14, Abnormal:  97)

ë°ì´í„° ë¬´ê²°ì„±:
  âœ“ ì¤‘ë³µ window_id: 0ê°œ (647 unique = 647 total)
  âœ“ NaN: 0ê°œ (ëª¨ë“  features ì™„ì „)
```

---

## ğŸ“Š ìƒì„¸ ê²€ì¦ ê²°ê³¼

### Pipeline Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input: Raw CSV Files (data/100W/, data/200W/)          â”‚
â”‚   - 60 files loaded (30 from 100W, 30 from 200W)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Load Labels & Create File Master               â”‚
â”‚   - Excel: ì‹œí—˜ì „ ì‹œë£Œ í‘œê¸°ë‚´ìš©.xlsx                    â”‚
â”‚   - Normal ì •ì˜: 100W S00, 200W S03                    â”‚
â”‚   - Result: 60 files, 4 Normal, 56 Abnormal           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Quality Check & Clean                          â”‚
â”‚   - clean_timeseries(): NaN interpolation, outliers   â”‚
â”‚   - create_quality_report(): 57/60 usable             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Train/Val/Test Split                           â”‚
â”‚   - Normal (4 files): ì‹œê°„ ê¸°ë°˜ ë‚´ë¶€ ë¶„í•              â”‚
â”‚     â€¢ Train: 0-60%, Val: 60-80%, Test: 80-100%        â”‚
â”‚   - Abnormal (56 files): íŒŒì¼ ë‹¨ìœ„ ë¶„í•                â”‚
â”‚     â€¢ Train: 70%, Val: 15%, Test: 15%                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Window Segmentation                            â”‚
â”‚   - Window size: 8ì´ˆ (4096 samples @ 512 Hz)          â”‚
â”‚   - Overlap: 50% (4ì´ˆ hop)                             â”‚
â”‚   - Stable margin: ì•/ë’¤ 10% ì œì™¸                      â”‚
â”‚   - Result: 650 windows â†’ 647 after filtering         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Feature Extraction (18 features)               â”‚
â”‚   Basic (9):                                           â”‚
â”‚     - RMS, Peak, Crest Factor                         â”‚
â”‚     - Channels: acc_Y, acc_Sum, Gyro_Y                â”‚
â”‚   Band RMS (9):                                        â”‚
â”‚     - Butterworth 4th order bandpass filter           â”‚
â”‚     - Bands: Low (1-10Hz), Mid (10-50Hz), High (50-150Hz) â”‚
â”‚     - Channels: acc_Y, acc_Sum, Gyro_Y                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Output: ecminer_stage1_output.csv                      â”‚
â”‚   - 647 rows Ã— 25 columns                             â”‚
â”‚   - 18 features + 7 metadata                          â”‚
â”‚   - No NaN, No duplicates                             â”‚
â”‚   - Ready for ECMiner import                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Feature List (18)

**ê¸°ë³¸ íŠ¹ì„± (9ê°œ)**:
1. acc_Y_rms
2. acc_Y_peak
3. acc_Y_crest
4. acc_Sum_rms
5. acc_Sum_peak
6. acc_Sum_crest
7. Gyro_Y_rms
8. Gyro_Y_peak
9. Gyro_Y_crest

**Band RMS íŠ¹ì„± (9ê°œ)**:
10. acc_Y_rms_low (1-10 Hz)
11. acc_Y_rms_mid (10-50 Hz)
12. acc_Y_rms_high (50-150 Hz)
13. acc_Sum_rms_low (1-10 Hz)
14. acc_Sum_rms_mid (10-50 Hz)
15. acc_Sum_rms_high (50-150 Hz)
16. Gyro_Y_rms_low (1-10 Hz)
17. Gyro_Y_rms_mid (10-50 Hz)
18. Gyro_Y_rms_high (50-150 Hz)

### Metadata Columns (7)

1. **window_id**: ê³ ìœ  ìœˆë„ìš° ì‹ë³„ì (ì˜ˆ: 100W_S00_CCW_R4_W0001)
2. **file_id**: ì›ë³¸ íŒŒì¼ ì‹ë³„ì (ì˜ˆ: 100W_S00_CCW_R4)
3. **dataset_type**: train / val / test
4. **label_binary**: 0 (Abnormal) / 1 (Normal)
5. **product**: 100W / 200W
6. **sample**: Sample ë²ˆí˜¸ (0-28)
7. **direction**: CW / CCW

---

## ğŸ¯ í•µì‹¬ í™•ì¸ ì‚¬í•­

### âœ… 1. Input: Raw CSV, Output: CSV

- **ì…ë ¥**: 60ê°œ Raw CSV íŒŒì¼ (data/100W/, data/200W/)
- **ì¶œë ¥**: 1ê°œ CSV íŒŒì¼ (ecminer_stage1_output.csv)
- **ì¤‘ê°„ ì‚°ì¶œë¬¼**: **ì—†ìŒ** (Parquet ë¯¸ì‚¬ìš©)

### âœ… 2. ëª¨ë“  ì „ì²˜ë¦¬ ê¸°ëŠ¥ í¬í•¨

- Raw CSV ë¡œë“œ âœ…
- ë ˆì´ë¸” ë§¤ì¹­ âœ…
- í’ˆì§ˆ ê²€ì‚¬ & í´ë¦¬ë‹ âœ…
- Train/Val/Test ë¶„í•  (ì‹œê°„ + íŒŒì¼ ê¸°ë°˜) âœ…
- ìœˆë„ìš° ìŠ¬ë¼ì´ë”© (8ì´ˆ, 50% ì˜¤ë²„ë©) âœ…
- ê¸°ë³¸ íŠ¹ì„± ì¶”ì¶œ (RMS, Peak, Crest) âœ…
- Band RMS ì¶”ì¶œ (Butterworth filter) âœ…

### âœ… 3. ì¤‘ê°„ ì‚°ì¶œë¬¼ ì—†ìŒ

- Parquet ì €ì¥: **0íšŒ**
- Parquet ë¡œë“œ: **0íšŒ**
- **Raw CSV â†’ ë©”ëª¨ë¦¬ â†’ CSV ì§ì ‘ ë³€í™˜**

### âœ… 4. ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥

- Oversampling: **ì—†ìŒ**
- ë°ì´í„° ì¦ê°•: **ì—†ìŒ**
- Balance í•¨ìˆ˜: **í˜¸ì¶œ ì•ˆí•¨**
- ì¤‘ë³µ window_id: **0ê°œ**
- NaN: **0ê°œ**

---

## ğŸ“ˆ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ECMiner 4-Parameter Test

**12 Features (Phase3-1 Core)**:
- Test AUC: **0.8085**
- Test Recall (Abnormal): 0.742
- Test Recall (Normal): 0.643

**18 Features (Phase2 Step 3-4)**:
- Test AUC: **0.8719**
- Test Recall (Abnormal): 0.825
- Test Recall (Normal): 0.786

**ê²°ë¡ **: ECMiner 4ê°œ íŒŒë¼ë¯¸í„°ë§Œìœ¼ë¡œë„ **ìš°ìˆ˜í•œ ì„±ëŠ¥** ë‹¬ì„± âœ…

---

## ğŸ‰ ìµœì¢… ê²°ë¡ 

### âœ… ëª¨ë“  ê²€ì¦ í•­ëª© í†µê³¼

1. âœ… **Input: Raw CSV, Output: CSV**
2. âœ… **ëª¨ë“  ì „ì²˜ë¦¬ ê¸°ëŠ¥ í¬í•¨** (8ë‹¨ê³„)
3. âœ… **ì¤‘ê°„ ì‚°ì¶œë¬¼ ì—†ìŒ** (Parquet ë¯¸ì‚¬ìš©)
4. âœ… **ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥** (ëˆ„ìˆ˜/ì¦ê°• ì—†ìŒ)
5. âœ… **ì„±ëŠ¥ ê²€ì¦ ì™„ë£Œ** (Test AUC 0.81-0.87)

### ğŸ“¦ ì‚°ì¶œë¬¼

1. **ecminer_stage1_complete.py** (270 lines)
   - ì™„ì „í•œ ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
   - Raw CSV â†’ 18 Features CSV

2. **ecminer_stage1_output.csv** (647 rows Ã— 25 columns)
   - ECMiner ì§ì ‘ import ê°€ëŠ¥
   - 18 features + 7 metadata

3. **test_ecminer_csv_performance.py**
   - 18 features vs 12 features ì„±ëŠ¥ ë¹„êµ
   - ECMiner 4-parameter ê²€ì¦

### ğŸš€ ë‹¤ìŒ ë‹¨ê³„: ECMiner êµ¬í˜„

**Stage 1**: Python Node
- `ecminer_stage1_complete.py` ì‹¤í–‰
- Output: 647 windows Ã— 18 features

**Stage 2**: Filter Node (Optional)
- 18 features â†’ 12 features ì„ íƒ
- ë˜ëŠ” 18 features ê·¸ëŒ€ë¡œ ì‚¬ìš©

**Stage 3**: XGBoost Node
- Parameters: n_estimators=100, max_depth=3, subsample=0.8, learning_rate=0.1
- Expected: Test AUC 0.81-0.87

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ECMiner 4-Parameter ì œì•½

**ì‚¬ìš© ê°€ëŠ¥**:
- n_estimators, max_depth, subsample, learning_rate

**ì‚¬ìš© ë¶ˆê°€** (XGBoost ê¸°ë³¸ê°’ ì ìš©):
- min_child_weight (ê¸°ë³¸ê°’: 1, Phase3-1ì—ì„œëŠ” 5)
- reg_lambda (ê¸°ë³¸ê°’: 1, Phase3-1ì—ì„œëŠ” 5)
- reg_alpha (ê¸°ë³¸ê°’: 0, Phase3-1ì—ì„œëŠ” 1)
- colsample_bytree (ê¸°ë³¸ê°’: 1, Phase3-1ì—ì„œëŠ” 0.8)

**ì˜í–¥**:
- ì •ê·œí™” íŒŒë¼ë¯¸í„° ë¶€ì¬ë¡œ **ê³¼ì í•© ìœ„í—˜ ì¦ê°€**
- í•˜ì§€ë§Œ Test AUCëŠ” ì˜¤íˆë ¤ í–¥ìƒë¨ (0.797 â†’ 0.8085)

### CV ê¸°ëŠ¥ ë¶€ì¬

- ECMinerëŠ” **CV ë¯¸ì§€ì›**
- Trainìœ¼ë¡œ í•™ìŠµ, Valë¡œ early stopping, Testë¡œ í‰ê°€
- StratifiedGroupKFold ë¶ˆê°€ (file_id ê·¸ë£¹í™” ë¶ˆê°€)

---

## âœ… ê²€ì¦ ì™„ë£Œ

**2025-11-24 ê²€ì¦ ì™„ë£Œ**
- ëª¨ë“  ìš”êµ¬ì‚¬í•­ ì¶©ì¡± âœ…
- ë°ì´í„° ë¬´ê²°ì„± í™•ë³´ âœ…
- ì„±ëŠ¥ ê²€ì¦ ì™„ë£Œ âœ…
- ECMiner êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ âœ…
