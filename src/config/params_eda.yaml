# ============================================================================
# EDA and Preprocessing Parameters for Actuator Vibration Analysis
# ============================================================================

# ============================================================================
# 양품 파일 정의 (특별 처리)
# ============================================================================
# 100W: Sample00만 정상
# 200W: Sample03 (소음 라벨이지만 양품으로 처리)
normal_samples:
  "100W": [0]      # Sample00
  "200W": [3]      # Sample03 (소음→양품 재분류)

# ============================================================================
# 라벨 처리
# ============================================================================
labels:
  # 이진 분류 맵핑
  binary_map:
    PASS: ["정상", "소음"]  # 소음은 기본적으로 PASS
    FAIL: ["진동", "표기없음"]

  # 특별 처리: 200W Sample03의 "소음"은 양품으로 강제 분류
  special_override:
    - product: "200W"
      sample: 3
      original_label: "소음"
      override_label: "정상"  # 양품 처리
      weight: 1.0

  # 약한 양성(소음) 가중치 (200W Sample03 제외한 나머지 소음)
  weak_positive_weight: 0.5

  # 표기없음 제외 여부
  exclude_unlabeled: false

# ============================================================================
# 데이터 분할 전략 (시간 기반 분할 - 양품 파일 부족 대응)
# ============================================================================
split:
  # 전략: time_based (양품이 각 제품당 1개씩만 존재)
  strategy: "time_based"

  # 파일 기반 분할 (참고용 - 양품 부족으로 사용 불가)
  file_based:
    enabled: false
    min_files_per_class: 3
    val_ratio: 0.15
    test_ratio: 0.15
    random_seed: 42

  # 시간 기반 분할 (양품 파일 내부를 시간 구간으로 분할)
  time_based:
    enabled: true
    # 양품 파일만 시간 분할 적용
    apply_to: ["normal"]

    # 시간 구간 비율 (전체 파일 길이 기준)
    train_range: [0.0, 0.6]    # 0-60%: train
    val_range: [0.6, 0.8]      # 60-80%: validation
    test_range: [0.8, 1.0]     # 80-100%: test

    # 불량 파일은 전체 파일 단위로 분할
    abnormal_split:
      train_ratio: 0.7
      val_ratio: 0.15
      test_ratio: 0.15
      random_seed: 42

# ============================================================================
# 데이터 품질 검사
# ============================================================================
quality:
  # 샘플링 주파수 검증 (±1% 허용)
  sampling_freq:
    expected: 512.0
    tolerance_ratio: 0.01  # 510-514 Hz 허용

  # 파일 길이 검증
  file_length:
    # 100W: ~27k-29k samples (~53-57초)
    # 200W: ~32k-35k samples (~62-68초) - 더 긴 측정시간
    expected_samples:
      "100W": [27000, 29000]
      "200W": [32000, 36000]
    tolerance_ratio: 0.1  # ±10%

  # NaN/결측치 처리
  missing_values:
    max_nan_ratio: 0.05  # 채널당 5% 초과 시 경고
    interpolation_method: "linear"

  # 스파이크/이상치 탐지
  outlier_detection:
    z_threshold: 8.0  # Z-score 기준
    clip_detection:
      consecutive_samples: 100  # 연속 동일값 100샘플 이상 시 경고

# ============================================================================
# 윈도우 세그먼트 생성
# ============================================================================
windowing:
  # 윈도우 파라미터
  window_sec: 8.0       # 8초 윈도우
  hop_sec: 4.0          # 4초 hop (50% 중첩)

  # 안정 구간 추출 (시동/정지 구간 제외)
  stable_margin: 0.1    # 앞/뒤 10% 제외

  # 파일별 최대 윈도우 수 (클래스 불균형 방지)
  max_windows_per_file: 200

  # 시간 분할 시 윈도우 경계 처리
  # 윈도우가 구간 경계를 넘는 경우 처리 방법
  boundary_handling: "strict"  # strict: 버림, overlap: 허용

# ============================================================================
# 클래스 균형 조정
# ============================================================================
balancing:
  # train 세트에서만 적용
  apply_to_train_only: true

  # 목표 비율 (정상:불량)
  target_ratio:
    normal: 1
    abnormal: 2  # 정상:불량 = 1:2

  # 방법: oversample (정상이 부족), undersample (불량이 과다), mixed
  method: "oversample"

  # 랜덤 시드
  random_seed: 42

# ============================================================================
# Feature 추출 (시간 영역)
# ============================================================================
features:
  # 사용 채널
  channels:
    acceleration: ["acc-X", "acc-Y", "acc-Z", "acc-Sum"]
    gyro: ["Gyro-X", "Gyro-Y", "Gyro-Z"]

  # 시간 영역 통계량
  time_domain:
    basic:
      - "mean"
      - "std"
      - "rms"
      - "peak"  # max(|x|)
    advanced:
      - "crest_factor"  # peak / rms
      - "kurtosis"
      - "skewness"

  # 메타 feature
  meta_features:
    - "product"      # 100W / 200W
    - "direction"    # CW / CCW
    - "sample"       # 시료 번호

# ============================================================================
# 제품별 처리
# ============================================================================
products:
  # 제품별 분리 모델 사용 여부
  separate_models: true

  # Direction feature 포함 여부
  include_direction_feature: true

  # 제품 목록
  list: ["100W", "200W"]

# ============================================================================
# 로깅 및 디버깅
# ============================================================================
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  save_logs: true
  log_file: "data/interim/pipeline.log"

# ============================================================================
# 재현성
# ============================================================================
reproducibility:
  random_seed: 42
  numpy_seed: 42
